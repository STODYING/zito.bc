<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>__OG_TITLE__ - Zito</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <link rel="apple-touch-icon" href="/images/favicon.png">
    
    <!-- OG ë©”íƒ€íƒœê·¸ (SSRë¡œ ì¹˜í™˜ë¨) -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="__OG_TITLE__" id="og-title">
    <meta property="og:description" content="__OG_DESCRIPTION__" id="og-description">
    <meta property="og:image" content="__OG_IMAGE__" id="og-image">
    <meta property="og:url" content="__OG_URL__" id="og-url">
    <link rel="canonical" href="__OG_URL__">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="__OG_TITLE__" id="twitter-title">
    <meta name="twitter:description" content="__OG_DESCRIPTION__" id="twitter-description">
    <meta name="twitter:image" content="__OG_IMAGE__" id="twitter-image">
    
    <style>
        /* [ìŠ¤íƒ€ì¼ ì‹œíŠ¸] ì‚¬ìš©ìì˜ ë””ìì¸ ì½”ë“œ ì™„ë²½ ìœ ì§€ */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; background: #f5f5f7; min-height: 100vh; overflow-x: hidden; }
        .loading { display: flex; align-items: center; justify-content: center; height: 100vh; font-size: 18px; color: #666; }
        .spinner { width: 40px; height: 40px; border: 4px solid #f0f0f0; border-top: 4px solid #000; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 16px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; color: #d32f2f; padding: 20px; text-align: center; }
        .error h1 { font-size: 72px; margin-bottom: 16px; }
        .error p { font-size: 18px; margin-bottom: 24px; }
        .error button { padding: 12px 24px; background: #000; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; }
        .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        .card-viewer { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: center; width: 100%; }
        @media (max-width: 968px) { .card-viewer { grid-template-columns: 1fr; } .container { align-items: flex-start; padding-top: 20px; } }
        .business-card { background: white; border-radius: 16px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); overflow: hidden; }
        .business-card.horizontal { aspect-ratio: 1.8 / 1; }
        .business-card.vertical { aspect-ratio: 1 / 1.8; max-width: 400px; margin: 0 auto; }
        .card-content { width: 100%; height: 100%; padding: 32px; color: white; display: flex; flex-direction: column; }
        .card-content.horizontal { justify-content: space-between; }
        .card-content.vertical { align-items: center; text-align: center; padding: 40px 24px; }
        .card-image { width: 100%; height: 100%; object-fit: cover; }
        .logo { width: 50px; height: 50px; border-radius: 8px; object-fit: contain; background: rgba(255, 255, 255, 0.1); }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .card-info h1 { font-size: 28px; font-weight: 700; margin-bottom: 8px; }
        .card-meta { font-size: 16px; opacity: 0.9; }
        .contact-info { display: flex; flex-direction: column; gap: 8px; font-size: 14px; opacity: 0.85; }
        .contact-row { display: flex; align-items: center; gap: 8px; }
        .details { background: white; border-radius: 16px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08); padding: 32px; max-height: 85vh; overflow-y: auto; }
        .details h2 { font-size: 24px; font-weight: 700; margin-bottom: 8px; }
        .profile-meta { font-size: 16px; color: #666; margin-bottom: 24px; }
        .profile-meta .divider { margin: 0 8px; color: #ccc; }
        .info-section { margin-bottom: 32px; }
        .info-section h3 { font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #333; }
        .info-row { display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid #f0f0f0; }
        .info-text { flex: 1; color: #333; font-size: 16px; }
        .about-content { line-height: 1.6; color: #555; white-space: pre-wrap; }
        .about-images-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 12px; margin-top: 12px; }
        .about-image-item { position: relative; aspect-ratio: 1; border-radius: 12px; overflow: hidden; cursor: pointer; transition: transform 0.2s; }
        .about-image-item:hover { transform: scale(1.03); }
        .about-image-item img { width: 100%; height: 100%; object-fit: cover; }
        .image-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 2000; justify-content: center; align-items: center; }
        .image-modal.show { display: flex; }
        .image-modal-content { position: relative; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; padding: 40px; }
        .image-modal-content img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .image-modal-close { position: fixed; top: 20px; right: 20px; color: white; font-size: 40px; cursor: pointer; background: none; border: none; z-index: 2100; }
        .actions { display: flex; gap: 12px; margin-top: 24px; }
        .btn { flex: 1; padding: 14px; border-radius: 12px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; border: none; }
        .btn-primary { background: #000; color: white; }
        .btn-secondary { background: #f0f0f0; color: #333; }
        .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 12px 24px; border-radius: 8px; opacity: 0; transition: opacity 0.3s; z-index: 3000; }
        .toast.show { opacity: 1; }
    </style>
</head>
<body>
    <div id="app">
        <div class="loading">
            <div class="spinner"></div>
            ëª…í•¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
        </div>
    </div>

    <!-- Firebase SDK v8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // [Firebase ì„¤ì •]
        const firebaseConfig = {
            apiKey: "AIzaSyExample123456789",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:704514531976:web:e72e93066eb83b93ad353d"
        };

        if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
        const db = firebase.firestore();

        let aboutImages = [];
        let currentImageIdx = 0;

        function getCardId() {
            const path = window.location.pathname;
            const match = path.match(/\/bc\/([^\/]+)/);
            return match ? match[1] : new URLSearchParams(window.location.search).get('id');
        }

        /**
         * ì›¹ ì¡°íšŒ ë¡œê·¸ ê¸°ë¡ (ì—„ê²©í•œ í”Œëœ ì²´í¬)
         */
        async function logView(cardId, data) {
            try {
                if (!data.ownerPlan || !data.ownerEnterprisePlan) return;
                if (data.ownerPlan === "FREE" && data.ownerEnterprisePlan === "NONE") return;

                const now = new Date();
                const expire = new Date();
                expire.setDate(now.getDate() + 365);

                await db.collection("users").doc(data.ownerUID).collection("viewLogs").add({
                    cardId: cardId,
                    platform: "web",
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    date: firebase.firestore.Timestamp.fromDate(now),
                    hour: now.getHours(),
                    dayOfWeek: now.getDay() + 1,
                    expireAt: firebase.firestore.Timestamp.fromDate(expire),
                    visitorInfo: { userAgent: navigator.userAgent, language: navigator.language }
                });
            } catch (e) { console.warn("ë¡œê·¸ ê¸°ë¡ ì‹¤íŒ¨:", e); }
        }

        /**
         * í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ì—…ë°ì´íŠ¸ (ì´ë¯¸ SSRë¡œ ë˜ì–´ìˆì§€ë§Œ, ë” ë¶€ë“œëŸ¬ìš´ ì „í™˜ì„ ìœ„í•´ ìœ ì§€)
         */
        function updateOG(data) {
            const name = data.name || "Zito";
            const title = `${name}ì˜ ëª…í•¨`;
            const desc = data.company ? `${data.company} | ${data.position || ""}` : (data.subtitle || "ë””ì§€í„¸ ëª…í•¨ì„ í™•ì¸í•˜ì„¸ìš”");
            const img = data.fullCardImageURL || data.logoImageURL || "";

            document.title = title;
        }

        async function init() {
            const cardId = getCardId();
            if (!cardId) { renderError("ì˜ëª»ëœ ë§í¬", "ì˜¬ë°”ë¥¸ ëª…í•¨ ì£¼ì†Œê°€ ì•„ë‹™ë‹ˆë‹¤."); return; }

            try {
                const snap = await db.collection("publicCards").doc(cardId).get();
                if (!snap.exists) { renderError("ëª…í•¨ ì—†ìŒ", "ì‚­ì œë˜ì—ˆê±°ë‚˜ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ëª…í•¨ì…ë‹ˆë‹¤."); return; }
                
                const data = snap.data();
                updateOG(data);
                
                // ì¡°íšŒìˆ˜ ê°€ì‚°
                db.collection("publicCards").doc(cardId).update({
                    webViewCount: firebase.firestore.FieldValue.increment(1)
                });
                logView(cardId, data);
                
                render(data);
            } catch (e) { renderError("í†µì‹  ì˜¤ë¥˜", "ëª…í•¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤."); }
        }

        function render(data) {
            const isV = data.isVertical || false;
            aboutImages = data.aboutImageURLs || [];
            const textColor = getTextColor(data.themeColor1Hex || "#000");

            const cardHTML = data.fullCardImageURL 
                ? `<img src="${data.fullCardImageURL}" class="card-image">`
                : renderCardUI(data, isV, textColor);

            const html = `
                <div class="container">
                    <div class="card-viewer">
                        <div class="business-card ${isV?'vertical':'horizontal'}" 
                             style="background: linear-gradient(135deg, ${data.themeColor1Hex || '#000'}, ${data.themeColor2Hex || '#333'})">
                            ${cardHTML}
                        </div>
                        <div class="details">
                            <h2>${data.name || 'Zito ì‚¬ìš©ì'}</h2>
                            <div class="profile-meta">
                                <b>${data.position || ''}</b> 
                                ${data.company ? `<span class="divider">|</span> ${data.company}` : ''}
                            </div>
                            <div class="info-section">
                                <h3>ì—°ë½ì²˜</h3>
                                ${data.phone ? `<div class="info-row"><div class="info-text">ğŸ“± ${data.phone}</div></div>` : ''}
                                ${data.email ? `<div class="info-row"><div class="info-text">âœ‰ï¸ ${data.email}</div></div>` : ''}
                                ${data.website ? `<div class="info-row"><div class="info-text">ğŸŒ <a href="${formatUrl(data.website)}" style="color:#000;text-decoration:none;" target="_blank">${data.website}</a></div></div>` : ''}
                            </div>
                            ${(data.about || aboutImages.length > 0) ? `
                                <div class="info-section">
                                    <h3>About</h3>
                                    ${data.subtitle ? `<p style="margin-bottom:8px; color:#666;">${data.subtitle}</p>` : ''}
                                    <div class="about-content">${data.about || ''}</div>
                                    <div class="about-images-grid">
                                        ${aboutImages.map((src, i) => `<div class="about-image-item" onclick="openModal(${i})"><img src="${src}"></div>`).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            <div class="actions">
                                ${data.phone ? `<button class="btn btn-primary" onclick="location.href='tel:${data.phone}'">ì „í™”í•˜ê¸°</button>` : ''}
                                ${data.email ? `<button class="btn btn-secondary" onclick="copyText('${data.email}')">ì´ë©”ì¼ ë³µì‚¬</button>` : ''}
                            </div>
                        </div>
                    </div>
                </div>
                <div id="imgModal" class="image-modal" onclick="closeModal()">
                    <button class="image-modal-close">&times;</button>
                    <div class="image-modal-content"><img id="modalImg"></div>
                </div>
                <div id="toast" class="toast">ë³µì‚¬ ì„±ê³µ!</div>
            `;
            document.getElementById("app").innerHTML = html;
        }

        function renderCardUI(data, isV, color) {
            return `<div class="card-content ${isV?'vertical':'horizontal'}" style="color:${color}">
                <div class="card-header">
                    <div class="card-info"><h1>${data.name || ''}</h1><p>${data.company || ''}</p></div>
                    ${data.logoImageURL ? `<img src="${data.logoImageURL}" class="logo">` : ''}
                </div>
                <div class="contact-info">
                    ${data.phone ? `<div>ğŸ“± ${data.phone}</div>` : ''}
                    ${data.email ? `<div>âœ‰ï¸ ${data.email}</div>` : ''}
                </div>
            </div>`;
        }

        function formatUrl(u) { return u.startsWith('http') ? u : 'https://' + u; }
        function getTextColor(h) { 
            const hex = h.replace('#','');
            if(hex.length < 6) return '#fff';
            const r = parseInt(hex.substring(0,2),16), g = parseInt(hex.substring(2,4),16), b = parseInt(hex.substring(4,6),16);
            return (r*0.299 + g*0.587 + b*0.114) > 186 ? '#000' : '#fff';
        }
        function copyText(t) { navigator.clipboard.writeText(t); const el = document.getElementById("toast"); el.classList.add("show"); setTimeout(()=>el.classList.remove("show"),2000); }
        function openModal(i) { document.getElementById("modalImg").src = aboutImages[i]; document.getElementById("imgModal").classList.add("show"); document.body.style.overflow='hidden'; }
        function closeModal() { document.getElementById("imgModal").classList.remove("show"); document.body.style.overflow=''; }
        function renderError(t, m) { document.getElementById("app").innerHTML = `<div class="error"><h1>!</h1><p><b>${t}</b></p><p>${m}</p></div>`; }

        document.addEventListener("DOMContentLoaded", init);
    </script>
</body>
</html>
