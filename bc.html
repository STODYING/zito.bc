export default {
  async fetch(request, env) {
    const url = new URL(request.url);
    // 주소창 뒤에 ?prompt=내용 형식으로 텍스트를 받습니다.
    const prompt = url.searchParams.get("prompt") || "a simple lego brick 3d render";

    // Cloudflare에서 제공하는 Stable Diffusion 기반 무료 모델 사용
    const inputs = { prompt: prompt };
    
    try {
      const response = await env.AI.run("@cf/bytedance/sdxl-lightning", inputs);
      return new Response(response, {
        headers: { "content-type": "image/png" },
      });
    } catch (e) {
      return new Response(e.message, { status: 500 });
    }
  },
};
